<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chris Chattom ‚Äî Music</title>
  <meta name="description" content="Original audio works by Chris Chattom." />

  <!-- Fonts & Tailwind -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React + Babel -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    :root{
      --accent:#00f5d4;
    }

    *{box-sizing:border-box;}
    html,body{height:100%;}
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background:#000;
      color:#f8fafc;
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
    }

    /* NAVBAR */
    .site-nav {
      display:flex;
      justify-content:center;
      gap:2.2rem;
      margin-top:2rem;
      font-weight:500;
    }
    .site-nav a {
      color:#f8fafc;
      text-decoration:none;
      position:relative;
      padding-bottom:4px;
      transition:color .3s ease;
    }
    .site-nav a::after{
      content:"";
      position:absolute;
      left:50%;
      bottom:0;
      width:0%;
      height:2px;
      background-color:var(--accent);
      border-radius:2px;
      transition:all .35s cubic-bezier(0.4,0,0.2,1);
      transform:translateX(-50%);
    }
    .site-nav a:hover::after{ width:100%; }
    .site-nav [aria-current="page"]{
      color:var(--accent);
    }
    .site-nav [aria-current="page"]::after{
      width:100%;
    }
    @media (max-width:640px){
      .site-nav{
        gap:1.2rem;
        margin-top:1rem;
        font-size:15px;
        flex-wrap:wrap;
      }
      .site-nav a{
        padding-bottom:6px;
        -webkit-tap-highlight-color:rgba(0,0,0,0);
      }
    }

    .wrap{
      max-width:960px;
      margin:0 auto;
      padding:32px 20px 48px;
    }
    .music-header {
      text-align:center;
      margin-bottom:1.5rem;
    }
    .music-header h1{
      font-size:clamp(24px,3vw,32px);
      margin:0 0 8px;
    }
    .music-header p{
      margin:0;
      color:#94a3b8;
      font-size:0.95rem;
    }

    #root{ margin-top:24px; }

    /* --- Retro tubes & deck --- */
    .tube-window{
      border-radius:1.25rem;
      border:1px solid rgba(148,163,184,0.6);
      background:radial-gradient(circle at 50% 0%, rgba(255,255,255,0.06), transparent 55%),
                 linear-gradient(to bottom,#020617,#020617,#020617,#020617,#020617);
      box-shadow:
        inset 0 0 40px rgba(15,23,42,1),
        0 24px 60px rgba(0,0,0,0.85);
      padding:1.5rem 1.75rem;
      display:flex;
      justify-content:space-between;
    }

    /* glassier tubes */
    .tube-shell{
      position:relative;
      width:48px;
      height:126px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.7);
      background:
        radial-gradient(circle at 20% 10%, rgba(255,255,255,0.55), transparent 55%),
        radial-gradient(circle at 80% 90%, rgba(15,23,42,0.95), #020617);
      box-shadow:
        inset 0 0 22px rgba(15,23,42,0.95),
        0 14px 32px rgba(0,0,0,0.9);
      display:flex;
      align-items:flex-end;
      justify-content:center;
      padding:8px;
      overflow:hidden;
    }
    .tube-shell::before{
      content:"";
      position:absolute;
      inset:10% 18%;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.35);
      opacity:0.75;
      pointer-events:none;
    }
    .tube-core{
      width:26px;
      border-radius:999px;
      background:
        radial-gradient(circle at 50% 0%, #f9fafb, #e5e7eb 45%, #94a3b8 85%),
        linear-gradient(to bottom, rgba(15,23,42,0.15), rgba(15,23,42,0.55));
      transition:height 120ms ease-out, box-shadow 120ms ease-out, opacity 120ms ease-out;
    }
    .tube-foot{
      margin-top:0.4rem;
      width:42px;
      height:6px;
      border-radius:999px;
      background:linear-gradient(to right,#020617,#1f2937,#020617);
      box-shadow:
        inset 0 1px 2px rgba(255,255,255,0.12),
        0 6px 14px rgba(0,0,0,0.9);
    }

    /* brushed-metal deck shell */
    .player-shell{
      background-image:
        linear-gradient(135deg, rgba(255,255,255,0.22), rgba(255,255,255,0) 42%),
        repeating-linear-gradient(90deg,
          rgba(148,163,184,0.22) 0px,
          rgba(148,163,184,0.22) 1px,
          rgba(15,23,42,0.9) 1px,
          rgba(15,23,42,0.9) 3px
        );
      background-blend-mode: soft-light, normal;
    }

    /* rubber feet */
    .deck-feet{
      margin-top:1.25rem;
      display:flex;
      justify-content:center;
      gap:2.5rem;
    }
    .deck-feet span{
      height:8px;
      width:64px;
      border-radius:999px;
      background:#020617;
      border:1px solid #020617;
      box-shadow:0 8px 14px rgba(0,0,0,0.9);
    }

    /* --- Progress strip --- */
    .progress-rail{
      position:relative;
      width:100%;
      height:10px;
      border-radius:999px;
      background:radial-gradient(circle at 50% 150%, rgba(15,23,42,0.9), #020617);
      box-shadow:
        inset 0 0 6px rgba(15,23,42,0.9),
        0 0 16px rgba(15,23,42,0.7);
      cursor:pointer;
      overflow:hidden;
    }
    .progress-fill{
      height:100%;
      border-radius:999px;
      background:linear-gradient(to right,#e5e7eb,#f9fafb,#e5e7eb);
      box-shadow:0 0 18px rgba(248,250,252,0.85);
      pointer-events:none;
    }

    /* --- Vintage transport buttons --- */
    .transport-btn{
      position:relative;
      border-radius:999px;
      width:46px;
      height:46px;
      display:flex;
      align-items:center;
      justify-content:center;
      border:1px solid rgba(148,163,184,0.7);
      background:
        radial-gradient(circle at 30% 18%, rgba(255,255,255,0.26), transparent 55%),
        radial-gradient(circle at 70% 82%, #020617, #020617);
      box-shadow:
        0 8px 16px rgba(0,0,0,0.7),
        inset 0 2px 4px rgba(255,255,255,0.36);
      transition:
        box-shadow 140ms ease,
        transform 120ms ease,
        border-color 140ms ease,
        background 140ms ease;
      color:#e5e7eb;
      cursor:pointer;
    }

    .transport-icon{
      font-size:14px;
      filter:drop-shadow(0 1px 1px rgba(0,0,0,0.9));
    }

    /* Glow helper: 2‚Äì3% at rest, 10‚Äì15% on hover */
    .glow-btn{
      filter: drop-shadow(0 0 3px var(--glow-soft));
      transition: filter 140ms ease, transform 120ms ease, box-shadow 140ms ease;
    }
    .glow-btn:hover,
    .glow-btn:active{
      filter: drop-shadow(0 0 10px var(--glow-strong));
    }

    /* Volume control */
    .volume-wrap{
      display:flex;
      align-items:center;
      gap:0.4rem;
    }
    .volume-slider{
      -webkit-appearance:none;
      appearance:none;
      height:4px;
      width:88px;
      border-radius:999px;
      background:linear-gradient(to right,#020617,#0f172a);
      outline:none;
      cursor:pointer;
    }
    .volume-slider::-webkit-slider-thumb{
      -webkit-appearance:none;
      appearance:none;
      width:14px;
      height:14px;
      border-radius:999px;
      background:radial-gradient(circle at 30% 20%, #f9fafb, #94a3b8);
      box-shadow:
        0 0 6px rgba(0,0,0,0.7),
        0 0 10px rgba(148,163,184,0.55);
      border:1px solid rgba(148,163,184,0.8);
    }
    .volume-slider::-moz-range-thumb{
      width:14px;
      height:14px;
      border-radius:999px;
      background:radial-gradient(circle at 30% 20%, #f9fafb, #94a3b8);
      box-shadow:
        0 0 6px rgba(0,0,0,0.7),
        0 0 10px rgba(148,163,184,0.55);
      border:1px solid rgba(148,163,184,0.8);
    }
  </style>
</head>
<body>
  <!-- Main nav -->
  <nav class="site-nav" aria-label="Main">
    <a href="/">Home</a>
    <a href="photography.html">Photography</a>
    <a href="music.html" aria-current="page">Music</a>
    <a href="/#contact">Contact</a>
  </nav>

  <div class="wrap">
    <header class="music-header">
      <h1>Original Audio Works</h1>
      <p>Instrumental tracks written &amp; produced by Chris Chattom.</p>
    </header>

    <div id="root"></div>
  </div>

  <!-- React app -->
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // -------- Track data ----------
    const TRACKS = [
      { id: '01', name: 'The Copycat',             file: 'The_Copycat.mp3' },
      { id: '02', name: 'Moving Forward',          file: 'Moving_Forward.mp3' },
      { id: '03', name: 'Fleetwood National',      file: 'Fleetwood_National.mp3' },
      { id: '04', name: 'Ashes and Aurora',        file: 'Ashes_and_Aurora.mp3' },
      { id: '05', name: 'Sugartrain Voyage',       file: 'Sugartrain_Voyage.mp3' },
      { id: '06', name: 'Car Crash in Cardiff',    file: 'Car_Crash_in_Cardiff.mp3' },
      { id: '07', name: 'Dune Audio',              file: 'Dune_Audio.mp3' },
      { id: '08', name: 'Slow Roast',              file: 'Slow_Roast.mp3' },
      { id: '09', name: 'Bayou Moon',              file: 'Bayou_Moon.mp3' },
      { id: '10', name: 'Lonely Carbon Lifeforms', file: 'Lonely_Carbon_Lifeforms.mp3' },
      { id: '11', name: 'The Magical Third',       file: 'The_Magical_Third.mp3' },
      { id: '12', name: 'Up and Down',             file: 'Up_and_Down.mp3' },
      { id: '13', name: 'Arcadia Drive',           file: 'Arcadia_Drive.mp3' },
      { id: '14', name: 'Ocean Post',              file: 'Ocean_Post.mp3' },
      { id: '15', name: 'Covert Company',          file: 'Covert_Company.mp3' },
      { id: '16', name: 'Too Many Lights',         file: 'Too_Many_Lights.mp3' },
      { id: '17', name: 'American Sword',          file: 'American_Sword.mp3' },
      { id: '18', name: 'Go Driving Fast',         file: 'Go_Driving_Fast.mp3' },
    ];
    const AUDIO_BASE = "assets/";

    // -------- Themes ----------
    const THEMES = {
      "nite life": {
        id: "nite life",
        label: "NITE LIFE",
        bg: "from-slate-800/90 to-slate-950/90",
        border: "border-slate-600",
        text: "text-slate-100",
        textSub: "text-slate-300",
        accent: "text-cyan-400",
        accentHex: "#22d3ee",
        glowSoft: "rgba(34, 211, 238, 0.03)",
        glowStrong: "rgba(34, 211, 238, 0.15)",
      },
      "day break": {
        id: "day break",
        label: "DAY BREAK",
        bg: "from-orange-100/90 to-amber-200/90",
        border: "border-orange-400",
        text: "text-slate-900",
        textSub: "text-orange-900",
        accent: "text-orange-600",
        accentHex: "#fb923c",
        glowSoft: "rgba(251, 146, 60, 0.03)",
        glowStrong: "rgba(251, 146, 60, 0.15)",
      },
      fantasy: {
        id: "fantasy",
        label: "FANTASY",
        bg: "from-purple-800/90 to-fuchsia-950/90",
        border: "border-purple-500",
        text: "text-purple-50",
        textSub: "text-purple-200",
        accent: "text-fuchsia-400",
        accentHex: "#e879f9",
        glowSoft: "rgba(232, 121, 249, 0.03)",
        glowStrong: "rgba(232, 121, 249, 0.15)",
      },
    };

    function formatTime(sec){
      if (!isFinite(sec) || sec < 0) return "0:00";
      const m = Math.floor(sec/60);
      const s = Math.floor(sec%60);
      return m + ":" + (s < 10 ? "0"+s : s);
    }

    // Web Audio hook: single level 0‚Äì1 from the HTMLAudioElement
    function useAudioLevel(audioElement, isPlaying){
      const [level,setLevel] = useState(0.15);
      const ctxRef = useRef(null);
      const analyserRef = useRef(null);
      const dataRef = useRef(null);
      const sourceRef = useRef(null);
      const rafRef = useRef(null);

      // Wire once
      useEffect(() => {
        if (!audioElement) return;
        if (ctxRef.current) return;

        const AudioCtx = window.AudioContext || window.webkitAudioContext;
        if (!AudioCtx) return;

        const ctx = new AudioCtx();
        const analyser = ctx.createAnalyser();
        analyser.fftSize = 256;
        const bufferLen = analyser.frequencyBinCount;
        const dataArray = new Uint8Array(bufferLen);

        const src = ctx.createMediaElementSource(audioElement);
        src.connect(analyser);
        analyser.connect(ctx.destination);

        ctxRef.current = ctx;
        analyserRef.current = analyser;
        dataRef.current = dataArray;
        sourceRef.current = src;

        return () => {
          if (rafRef.current) cancelAnimationFrame(rafRef.current);
          if (sourceRef.current) sourceRef.current.disconnect();
          if (analyserRef.current) analyserRef.current.disconnect();
          if (ctxRef.current && ctxRef.current.state !== "closed"){
            ctxRef.current.close();
          }
        };
      }, [audioElement]);

      // Animate while playing
      useEffect(() => {
        const ctx = ctxRef.current;
        const analyser = analyserRef.current;
        const dataArray = dataRef.current;

        if (!ctx || !analyser || !dataArray){
          if (!isPlaying) setLevel(0.12);
          return;
        }

        if (!isPlaying){
          if (rafRef.current) cancelAnimationFrame(rafRef.current);
          setLevel(0.12);
          return;
        }

        const bufferLen = analyser.frequencyBinCount;

        const tick = () => {
          analyser.getByteFrequencyData(dataArray);
          let sum = 0;
          for (let i=0;i<bufferLen;i++) sum += dataArray[i];
          const avg = sum / bufferLen;
          const norm = avg / 255;
          const next = 0.1 + norm*0.9;
          setLevel(next);
          rafRef.current = requestAnimationFrame(tick);
        };

        ctx.resume().then(() => {
          rafRef.current = requestAnimationFrame(tick);
        });

        return () => {
          if (rafRef.current) cancelAnimationFrame(rafRef.current);
        };
      }, [isPlaying]);

      return level;
    }

    // ---------- UI Components ----------
    function ThemeChips({ active, onChange }){
      return (
        <div className="flex flex-wrap justify-center gap-3 mb-6">
          {Object.entries(THEMES).map(([id,t]) => {
            const selected = id === active;
            const base = "px-4 py-1 rounded-full text-xs tracking-[0.16em] font-semibold uppercase border transition-all shadow-sm";
            let bg;
            if (id === "nite life") bg = "bg-slate-900/90 text-cyan-100 border-slate-600";
            if (id === "day break") bg = "bg-amber-200 text-orange-900 border-orange-500";
            if (id === "fantasy") bg = "bg-purple-900/80 text-purple-100 border-purple-500";
            return (
              <button
                key={id}
                type="button"
                onClick={() => onChange(id)}
                className={base + " " + bg + " " + (selected ? "ring-2 ring-offset-2 ring-offset-black" : "opacity-80 hover:opacity-100")}
              >
                {t.label}
              </button>
            );
          })}
        </div>
      );
    }

    function TubeDeck({ trackName, currentTime, duration, theme, level, onSeekClick }){
      const t = THEMES[theme];
      const tubes = [0,1,2,3,4].map(() => level);
      const glow = t.accentHex + "dd";
      const progressPercent = duration ? Math.min(100, (currentTime / duration) * 100) : 0;

      return (
        <div className={[
          "w-full max-w-3xl mx-auto rounded-3xl border px-6 py-5 mb-6",
          "bg-gradient-to-b", t.bg, t.border, "shadow-2xl", "player-shell"
        ].join(" ")}>
          <div className="tube-window mb-5">
            {tubes.map((lvl,i) => (
              <div key={i} className="flex flex-col items-center">
                <div className="tube-shell">
                  <div
                    className="tube-core"
                    style={{
                      height: (42 + lvl*60) + "px",
                      boxShadow: `0 0 ${14 + lvl*26}px ${glow}`,
                      opacity: 0.55 + lvl*0.4
                    }}
                  />
                </div>
                <div className="tube-foot" />
              </div>
            ))}
          </div>

          <div className="text-center mb-4">
            <div className={t.text + " text-lg font-semibold"}>
              {trackName || "Select a track from the playlist"}
            </div>
          </div>

          <div className="mt-2">
            <div className="flex items-center justify-between text-[11px] text-slate-400 mb-1 px-0.5">
              <span>{formatTime(currentTime)}</span>
              <span>{formatTime(duration)}</span>
            </div>
            <div className="progress-rail" onClick={onSeekClick}>
              <div
                className="progress-fill"
                style={{ width: progressPercent + "%" }}
              />
            </div>
          </div>

          <div className="deck-feet">
            <span></span>
            <span></span>
          </div>
        </div>
      );
    }

    function VintageControls({
      onPlay,
      onPause,
      onStop,
      onSkipBack,
      onSkipForward,
      onNudgeBack,
      onNudgeForward,
      isPlaying,
      theme,
      volume,
      isMuted,
      onVolumeChange,
      onToggleMute,
    }) {
      const themeDef = THEMES[theme];

      const baseBtn =
        "transport-btn glow-btn w-10 h-10 sm:w-11 sm:h-11 flex items-center justify-center";

      const playScale = " scale-[1.12]";

      const glowVars = {
        "--glow-soft": themeDef.glowSoft,
        "--glow-strong": themeDef.glowStrong,
      };

      return (
        <div className="flex items-center justify-center gap-4 mb-6">
          {/* Volume + mute block on the left */}
          <div className="volume-wrap glow-btn" style={glowVars}>
            <button
              type="button"
              aria-label={isMuted ? "Unmute" : "Mute"}
              onClick={onToggleMute}
              className={
                "w-8 h-8 rounded-full flex items-center justify-center " +
                "bg-slate-900/90 border border-slate-600/80 text-slate-100 " +
                "shadow-[0_4px_10px_rgba(0,0,0,0.6)] focus:outline-none"
              }
            >
              <span className="text-[11px]">
                {isMuted ? "üîá" : "üîà"}
              </span>
            </button>

            <input
              className="volume-slider"
              type="range"
              min="0"
              max="100"
              value={Math.round(volume * 100)}
              onChange={(e) =>
                onVolumeChange(parseInt(e.target.value, 10) / 100)
              }
            />
          </div>

          {/* Transport controls */}
          <div className="flex items-center justify-center gap-3 sm:gap-4">
            {/* ‚èÆ REVERSE SKIP (previous track) */}
            <button
              aria-label="Previous track"
              type="button"
              onClick={onSkipBack}
              className={baseBtn}
              style={glowVars}
            >
              <span className="transport-icon text-xs">‚èÆ</span>
            </button>

            {/* ‚è™ REWIND (small nudge back) */}
            <button
              aria-label="Rewind"
              type="button"
              onClick={onNudgeBack}
              className={baseBtn}
              style={glowVars}
            >
              <span className="transport-icon text-xs">‚è™</span>
            </button>

            {/* ‚ñ∂ PLAY (always start / resume) */}
            <button
              aria-label="Play"
              type="button"
              onClick={onPlay}
              className={baseBtn + playScale}
              style={{
                ...glowVars,
                boxShadow: isPlaying
                  ? `0 0 16px ${themeDef.accentHex}aa, 0 8px 18px rgba(0,0,0,0.7)`
                  : "0 8px 18px rgba(0,0,0,0.65)",
              }}
            >
              <span className="transport-icon text-sm">‚ñ∂</span>
            </button>

            {/* ‚è∏ PAUSE (toggles pause / resume) */}
            <button
              aria-label="Pause / Resume"
              type="button"
              onClick={() => (isPlaying ? onPause() : onPlay())}
              className={baseBtn}
              style={glowVars}
            >
              <span className="transport-icon text-sm">‚è∏</span>
            </button>

            {/* ‚ñ† STOP (stop + return to 0) */}
            <button
              aria-label="Stop"
              type="button"
              onClick={onStop}
              className={baseBtn}
              style={glowVars}
            >
              <span className="transport-icon text-xs">‚ñ†</span>
            </button>

            {/* ‚è© FAST FORWARD (small nudge forward) */}
            <button
              aria-label="Fast forward"
              type="button"
              onClick={onNudgeForward}
              className={baseBtn}
              style={glowVars}
            >
              <span className="transport-icon text-xs">‚è©</span>
            </button>

            {/* ‚è≠ FORWARD SKIP (next track) */}
            <button
              aria-label="Next track"
              type="button"
              onClick={onSkipForward}
              className={baseBtn}
              style={glowVars}
            >
              <span className="transport-icon text-xs">‚è≠</span>
            </button>
          </div>
        </div>
      );
    }

    function Playlist({ tracks, currentIndex, onSelect, theme }){
      const t = THEMES[theme];
      return (
        <div className={[
          "w-full max-w-3xl mx-auto rounded-3xl border p-5 sm:p-6 shadow-2xl",
          "bg-gradient-to-b", t.bg, t.border
        ].join(" ")}>
          <div className="mb-2">
            <div className="text-[11px] tracking-[0.26em] text-slate-400 uppercase mb-1">
              PLAYLIST
            </div>
            <div className="text-[11px] text-slate-500">
              {tracks.length} Tracks
            </div>
          </div>

          <div className="mt-3 space-y-2 max-h-[480px] overflow-y-auto pr-1">
            {tracks.map((trk, idx) => {
              const active = idx === currentIndex;
              return (
                <button
                  key={trk.id}
                  type="button"
                  onClick={() => onSelect(idx)}
                  className={[
                    "w-full flex items-center justify-between rounded-xl px-3 py-3 text-left border transition-all",
                    active
                      ? "bg-cyan-700/50 border-cyan-400/80 shadow-[0_0_18px_rgba(34,211,238,0.35)]"
                      : "bg-slate-950/40 border-slate-700/70 hover:border-slate-500/70"
                  ].join(" ")}
                >
                  <div className="flex items-center gap-3 min-w-0">
                    <div className="w-5 text-xs text-slate-500">
                      {String(idx+1).padStart(2,"0")}
                    </div>
                    <div className="flex flex-col min-w-0">
                      <span className="text-sm text-slate-100 truncate">
                        {trk.name}
                      </span>
                      <span className="text-[11px] text-cyan-300/80">
                        Track {idx+1}
                      </span>
                    </div>
                  </div>
                </button>
              );
            })}
          </div>
        </div>
      );
    }

    // ---------- Root app ----------
    function MusicApp(){
      const [currentIndex,setCurrentIndex] = useState(0);
      const [theme,setTheme] = useState("nite life");
      const [isPlaying,setIsPlaying] = useState(true);
      const [currentTime,setCurrentTime] = useState(0);
      const [duration,setDuration] = useState(0);

      const [volume, setVolume] = useState(1);
      const [isMuted, setIsMuted] = useState(false);
      const [lastVolume, setLastVolume] = useState(1);

      const audioRef = useRef(null);
      const activeTrack = TRACKS[currentIndex];

      const level = useAudioLevel(audioRef.current, isPlaying);

      // wire time/duration + ended (auto-advance)
      useEffect(() => {
        const audio = audioRef.current;
        if (!audio) return;

        const onTime = () => setCurrentTime(audio.currentTime || 0);
        const onMeta = () => setDuration(audio.duration || 0);
        const onEnd = () => {
          setCurrentIndex(prev => (prev + 1) % TRACKS.length);
          setCurrentTime(0);
          setIsPlaying(true);
        };

        audio.addEventListener("timeupdate", onTime);
        audio.addEventListener("loadedmetadata", onMeta);
        audio.addEventListener("ended", onEnd);

        return () => {
          audio.removeEventListener("timeupdate", onTime);
          audio.removeEventListener("loadedmetadata", onMeta);
          audio.removeEventListener("ended", onEnd);
        };
      }, []);

      // load track whenever index or activeTrack changes
      useEffect(() => {
        const audio = audioRef.current;
        if (!audio || !activeTrack) return;
        audio.src = AUDIO_BASE + activeTrack.file;
        audio.load();
        setCurrentTime(0);
        if (isPlaying){
          audio.play().catch(() => setIsPlaying(false));
        }
      }, [currentIndex, activeTrack, isPlaying]);

      // keep volume on <audio> in sync
      useEffect(() => {
        const audio = audioRef.current;
        if (!audio) return;
        audio.volume = volume;
      }, [volume]);

      // nudge +/- in seconds
      const handleNudge = (deltaSeconds) => {
        const audio = audioRef.current;
        if (!audio || !duration) return;
        const next = Math.max(0, Math.min(duration, (audio.currentTime || 0) + deltaSeconds));
        audio.currentTime = next;
        setCurrentTime(next);
      };

      // PLAY (start / resume)
      const handlePlay = () => {
        const audio = audioRef.current;
        if (!audio) return;
        audio.play()
          .then(() => setIsPlaying(true))
          .catch(() => {});
      };

      // PAUSE (stop at current position; resume from here)
      const handlePause = () => {
        const audio = audioRef.current;
        if (!audio) return;
        audio.pause();
        setIsPlaying(false);
      };

      // STOP (reset to zero)
      const handleStop = () => {
        const audio = audioRef.current;
        if (!audio) return;
        audio.pause();
        audio.currentTime = 0;
        setCurrentTime(0);
        setIsPlaying(false);
      };

      const handleSkipBack = () => {
        setCurrentIndex(prev => (prev - 1 + TRACKS.length) % TRACKS.length);
      };
      const handleSkipForward = () => {
        setCurrentIndex(prev => (prev + 1) % TRACKS.length);
      };

      const handleRewind = () => handleNudge(-3);
      const handleFastForward = () => handleNudge(3);

      const handleSelectTrack = (idx) => {
        setCurrentIndex(idx);
        setIsPlaying(true); // auto-play on selection
      };

      const handleSeekClick = (e) => {
        const audio = audioRef.current;
        if (!audio || !duration) return;
        const rect = e.currentTarget.getBoundingClientRect();
        const ratio = (e.clientX - rect.left) / rect.width;
        const clamped = Math.max(0, Math.min(1, ratio));
        const newTime = clamped * duration;
        audio.currentTime = newTime;
        setCurrentTime(newTime);
      };

      const handleVolumeChange = (v) => {
        const clamped = Math.max(0, Math.min(1, v));
        setVolume(clamped);

        if (clamped === 0) {
          setIsMuted(true);
        } else {
          setIsMuted(false);
          setLastVolume(clamped);
        }
      };

      const handleToggleMute = () => {
        setIsMuted((prev) => {
          const next = !prev;
          if (next) {
            setLastVolume(volume || 1);
            setVolume(0);
          } else {
            setVolume(lastVolume || 1);
          }
          return next;
        });
      };

      return (
        <div className="mt-6 flex flex-col items-center">
          <ThemeChips active={theme} onChange={setTheme} />

          <TubeDeck
            trackName={activeTrack ? activeTrack.name : ""}
            currentTime={currentTime}
            duration={duration}
            theme={theme}
            level={level}
            onSeekClick={handleSeekClick}
          />

          <VintageControls
            onSkipBack={handleSkipBack}
            onNudgeBack={handleRewind}
            onPlay={handlePlay}
            onPause={handlePause}
            onStop={handleStop}
            onNudgeForward={handleFastForward}
            onSkipForward={handleSkipForward}
            isPlaying={isPlaying}
            theme={theme}
            volume={volume}
            isMuted={isMuted}
            onVolumeChange={handleVolumeChange}
            onToggleMute={handleToggleMute}
          />

          <Playlist
            tracks={TRACKS}
            currentIndex={currentIndex}
            onSelect={handleSelectTrack}
            theme={theme}
          />

          {/* Hidden audio element actual player */}
          <audio ref={audioRef} className="hidden">
            Your browser does not support the audio element.
          </audio>
        </div>
      );
    }

    const rootEl = document.getElementById("root");
    if (rootEl){
      const root = ReactDOM.createRoot(rootEl);
      root.render(<MusicApp />);
    }
  </script>
</body>
</html>
