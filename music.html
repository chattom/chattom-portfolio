<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chris Chattom ‚Äî Music</title>
  <meta name="description" content="Music by Chris Chattom." />

  <!-- Same font as main site -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React + Babel (for in-page JSX) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    :root{
      --accent:#00f5d4;
    }

    *{box-sizing:border-box;}

    html,body{height:100%;}
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background:#000;
      color:#f8fafc;
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
    }

    /* NAVBAR (white-on-black version) */
    .site-nav {
      display:flex;
      justify-content:center;
      gap:2.2rem;
      margin-top:2rem;
      font-weight:500;
    }

    .site-nav a {
      color:#f8fafc;
      text-decoration:none;
      position:relative;
      padding-bottom:4px;
      transition:color .3s ease;
    }
    .site-nav a::after{
      content:"";
      position:absolute;
      left:50%;
      bottom:0;
      width:0%;
      height:2px;
      background-color:var(--accent);
      border-radius:2px;
      transition:all .35s cubic-bezier(0.4,0,0.2,1);
      transform:translateX(-50%);
    }
    .site-nav a:hover::after{ width:100%; }

    .site-nav [aria-current="page"]{
      color:var(--accent);
    }
    .site-nav [aria-current="page"]::after{
      width:100%;
    }

    @media (max-width:640px){
      .site-nav{
        gap:1.2rem;
        margin-top:1rem;
        font-size:15px;
        flex-wrap:wrap;
      }
      .site-nav a{
        padding-bottom:6px;
        -webkit-tap-highlight-color:rgba(0,0,0,0);
      }
    }

    .wrap{
      max-width:960px;
      margin:0 auto;
      padding:32px 20px 48px;
    }

    h1{
      font-size:clamp(24px,3vw,32px);
      margin:0 0 12px;
    }
    p.lead{
      margin:0 0 24px;
      color:#94a3b8;
    }

    #root{
      margin-top:24px;
    }
  </style>
</head>
<body>
  <!-- Local nav for this page -->
  <nav class="site-nav" aria-label="Main">
    <a href="/">Home</a>
    <a href="photography.html">Photography</a>
    <a href="music.html" aria-current="page">Music</a>
    <a href="/#contact">Contact</a>
  </nav>

  <div class="wrap">
    <header class="text-center mb-6">
      <h1>Original Audio Works</h1>
      <p class="lead">Instrumental tracks written &amp; produced by Chris Chattom.</p>
    </header>

    <div id="root"></div>
  </div>

  <!-- Single React app -->
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // ----------------- Track data -----------------
    const TRACKS = [
      { id: 'copycat',          name: 'The Copycat',             file: 'The_Copycat.mp3' },
      { id: 'moving-forward',   name: 'Moving Forward',          file: 'Moving_Forward.mp3' },
      { id: 'fleetwood',        name: 'Fleetwood National',      file: 'Fleetwood_National.mp3' },
      { id: 'ashes',            name: 'Ashes and Aurora',        file: 'Ashes_and_Aurora.mp3' },
      { id: 'sugartrain',       name: 'Sugartrain Voyage',       file: 'Sugartrain_Voyage.mp3' },
      { id: 'cardiff',          name: 'Car Crash in Cardiff',    file: 'Car_Crash_in_Cardiff.mp3' },
      { id: 'dune',             name: 'Dune Audio',              file: 'Dune_Audio.mp3' },
      { id: 'slow-roast',       name: 'Slow Roast',              file: 'Slow_Roast.mp3' },
      { id: 'bayou-moon',       name: 'Bayou Moon',              file: 'Bayou_Moon.mp3' },
      { id: 'lonely-carbon',    name: 'Lonely Carbon Lifeforms', file: 'Lonely_Carbon_Lifeforms.mp3' },
      { id: 'magical-third',    name: 'The Magical Third',       file: 'The_Magical_Third.mp3' },
      { id: 'up-down',          name: 'Up and Down',             file: 'Up_and_Down.mp3' },
      { id: 'arcadia',          name: 'Arcadia Drive',           file: 'Arcadia_Drive.mp3' },
      { id: 'ocean-post',       name: 'Ocean Post',              file: 'Ocean_Post.mp3' },
      { id: 'covert-company',   name: 'Covert Company',          file: 'Covert_Company.mp3' },
      { id: 'too-many-lights',  name: 'Too Many Lights',         file: 'Too_Many_Lights.mp3' },
      { id: 'american-sword',   name: 'American Sword',          file: 'American_Sword.mp3' },
      { id: 'go-driving-fast',  name: 'Go Driving Fast',         file: 'Go_Driving_Fast.mp3' },
    ];

    const AUDIO_BASE = "assets/";

    // ------------- Theme definitions --------------
    const THEMES = {
      "nite life": {
        id: "nite life",
        label: "NITE LIFE",
        bg: "from-slate-800/90 to-slate-950/90",
        border: "border-slate-600",
        text: "text-slate-100",
        textSub: "text-slate-300",
        accentHex: "#22d3ee",
      },
      "day break": {
        id: "day break",
        label: "DAY BREAK",
        bg: "from-orange-100/90 to-amber-200/90",
        border: "border-orange-400",
        text: "text-slate-900",
        textSub: "text-orange-900",
        accentHex: "#fb923c",
      },
      "fantasy": {
        id: "fantasy",
        label: "FANTASY",
        bg: "from-purple-800/90 to-fuchsia-950/90",
        border: "border-purple-500",
        text: "text-purple-50",
        textSub: "text-purple-200",
        accentHex: "#e879f9",
      }
    };

    function formatTime(sec) {
      if (!isFinite(sec) || sec < 0) return "0:00";
      const m = Math.floor(sec / 60);
      const s = Math.floor(sec % 60);
      return m + ":" + (s < 10 ? "0" + s : s);
    }

    // üîä Web Audio hook to get overall loudness level
    function useAudioLevel(audioElement, isPlaying) {
      const [level, setLevel] = useState(0.15);
      const ctxRef = useRef(null);
      const analyserRef = useRef(null);
      const dataRef = useRef(null);
      const sourceRef = useRef(null);
      const rafRef = useRef(null);

      // Wire analyser once when we get a real HTMLAudioElement
      useEffect(() => {
        if (!audioElement) return;
        if (ctxRef.current) return;

        const AudioCtx = window.AudioContext || window.webkitAudioContext;
        if (!AudioCtx) return;

        const ctx = new AudioCtx();
        const analyser = ctx.createAnalyser();
        analyser.fftSize = 256;

        const bufferLength = analyser.frequencyBinCount;
        const dataArray = new Uint8Array(bufferLength);

        const source = ctx.createMediaElementSource(audioElement);
        source.connect(analyser);
        analyser.connect(ctx.destination);

        ctxRef.current = ctx;
        analyserRef.current = analyser;
        dataRef.current = dataArray;
        sourceRef.current = source;

        return () => {
          cancelAnimationFrame(rafRef.current);
          if (sourceRef.current) sourceRef.current.disconnect();
          if (analyserRef.current) analyserRef.current.disconnect();
          if (ctxRef.current && ctxRef.current.state !== "closed") {
            ctxRef.current.close();
          }
        };
      }, [audioElement]);

      // Animate while playing
      useEffect(() => {
        const analyser = analyserRef.current;
        const ctx = ctxRef.current;
        const dataArray = dataRef.current;

        if (!analyser || !ctx || !dataArray) {
          if (!isPlaying) setLevel(0.12);
          return;
        }

        if (!isPlaying) {
          cancelAnimationFrame(rafRef.current);
          setLevel(0.12);
          return;
        }

        const bufferLength = analyser.frequencyBinCount;

        const tick = () => {
          analyser.getByteFrequencyData(dataArray);
          let sum = 0;
          for (let i = 0; i < bufferLength; i++) sum += dataArray[i];
          const avg = sum / bufferLength;
          const norm = avg / 255;
          const next = 0.1 + norm * 0.9;
          setLevel(next);
          rafRef.current = requestAnimationFrame(tick);
        };

        ctx.resume().then(() => {
          rafRef.current = requestAnimationFrame(tick);
        });

        return () => cancelAnimationFrame(rafRef.current);
      }, [isPlaying]);

      return level;
    }

    // ---------- UI components ----------

    function ThemeChips({ activeTheme, onChange }) {
      return (
        <div className="flex justify-center gap-3 mb-6 flex-wrap">
          {Object.values(THEMES).map((t) => {
            const active = t.id === activeTheme;
            const base =
              "px-4 py-1 rounded-full text-[11px] tracking-[0.16em] font-semibold uppercase transition-all border border-transparent shadow-sm";
            let colorClass = "";
            if (t.id === "nite life") colorClass = "bg-slate-900/90 text-cyan-100";
            if (t.id === "day break") colorClass = "bg-amber-200 text-orange-900";
            if (t.id === "fantasy")   colorClass = "bg-fuchsia-900/90 text-fuchsia-100";
            return (
              <button
                key={t.id}
                onClick={() => onChange(t.id)}
                className={[
                  base,
                  colorClass,
                  active ? "ring-2 ring-offset-2 ring-offset-black" : "opacity-80 hover:opacity-100"
                ].join(" ")}
              >
                {t.label}
              </button>
            );
          })}
        </div>
      );
    }

    function TubeDeck({ trackName, currentTime, duration, theme, level, onSeek }) {
      const t = THEMES[theme];
      const tubes = [0,1,2,3,4].map(() => level);

      const handleBarClick = (e) => {
        if (!duration || !onSeek) return;
        const rect = e.currentTarget.getBoundingClientRect();
        const ratio = (e.clientX - rect.left) / rect.width;
        const clamped = Math.max(0, Math.min(1, ratio));
        onSeek(clamped * duration);
      };

      return (
        <div
          className={[
            "w-full max-w-3xl mx-auto rounded-3xl border shadow-2xl px-6 py-5 mb-6",
            "bg-gradient-to-b", t.bg, t.border
          ].join(" ")}
        >
          {/* Tube window */}
          <div className="rounded-2xl border border-slate-700/60 bg-slate-900/70 px-6 py-6 mb-5 flex justify-between">
            {tubes.map((lvl, i) => (
              <div key={i} className="flex flex-col items-center">
                <div className="w-[42px] h-[120px] rounded-full border border-slate-500/70 bg-gradient-to-b from-slate-800/95 to-slate-900/95 flex items-end justify-center shadow-[0_0_28px_rgba(0,0,0,0.7)]">
                  <div
                    className="w-[24px] rounded-full bg-gradient-to-b from-white/90 to-slate-200/40"
                    style={{
                      height: `${40 + lvl * 60}px`,
                      boxShadow: `0 0 ${12 + lvl * 18}px ${t.accentHex}cc`
                    }}
                  />
                </div>
                <div className="mt-2 w-9 h-3 rounded-full bg-slate-800 border border-slate-600/80" />
              </div>
            ))}
          </div>

          {/* Track title */}
          <div className="text-center mb-4">
            <div className={[t.text, "font-semibold text-lg"].join(" ")}>
              {trackName || "Select a track from the playlist"}
            </div>
          </div>

          {/* Timeline (click to seek) */}
          <div className="mt-2">
            <div className="flex items-center gap-3 text-[11px] text-slate-400 mb-2 px-1">
              <span>{formatTime(currentTime)}</span>
              <div className="flex-1 h-px bg-slate-700/80" />
              <span>{formatTime(duration)}</span>
            </div>
            <div
              className="w-full h-2 rounded-full bg-slate-900/80 overflow-hidden shadow-inner cursor-pointer"
              onClick={handleBarClick}
            >
              <div
                className="h-full bg-gradient-to-r from-slate-100 via-slate-200 to-slate-50 rounded-full"
                style={{
                  width: duration
                    ? `${Math.min(100, (currentTime / duration) * 100)}%`
                    : "0%"
                }}
              />
            </div>
          </div>
        </div>
      );
    }

    function VintageControls({ onPlay, onPause, onStop, onPrev, onNext, isPlaying, theme }) {
      const t = THEMES[theme];
      const baseBtn =
        "w-10 h-10 sm:w-11 sm:h-11 rounded-full flex items-center justify-center " +
        "bg-slate-900/90 border border-slate-600/80 text-slate-100 " +
        "shadow-[0_8px_18px_rgba(0,0,0,0.65)] " +
        "transition-all transform hover:-translate-y-[1px] focus:outline-none " +
        "hover:shadow-[0_0_16px]";
      const glow = `drop-shadow(0 0 10px ${t.accentHex})`;

      return (
        <div className="flex items-center justify-center gap-3 sm:gap-4 mb-6">
          <button
            aria-label="Previous track"
            onClick={onPrev}
            className={baseBtn}
            style={{ filter: glow }}
          >
            <span className="text-xs">‚èÆ</span>
          </button>

          <button
            aria-label="Play"
            onClick={onPlay}
            className={baseBtn + " scale-110"}
            style={{ filter: glow, boxShadow: `0 0 18px ${t.accentHex}cc` }}
          >
            <span className="text-sm">‚ñ∂</span>
          </button>

          <button
            aria-label="Pause"
            onClick={onPause}
            className={baseBtn}
            style={isPlaying ? { filter: glow } : {}}
          >
            <span className="text-sm">‚è∏</span>
          </button>

          <button
            aria-label="Stop"
            onClick={onStop}
            className={baseBtn}
          >
            <span className="text-xs">‚ñ†</span>
          </button>

          <button
            aria-label="Next track"
            onClick={onNext}
            className={baseBtn}
            style={{ filter: glow }}
          >
            <span className="text-xs">‚è≠</span>
          </button>
        </div>
      );
    }

    function Playlist({ tracks, currentIndex, onSelect, theme }) {
      const t = THEMES[theme];

      return (
        <div
          className={[
            "w-full max-w-3xl mx-auto rounded-3xl border",
            "bg-gradient-to-b", t.bg, t.border,
            "p-5 sm:p-6 shadow-2xl"
          ].join(" ")}
        >
          <div className="mb-2">
            <div className="text-[11px] tracking-[0.26em] text-slate-400 uppercase mb-1">
              PLAYLIST
            </div>
            <div className="text-[11px] text-slate-500">
              {tracks.length} Tracks
            </div>
          </div>

          <div className="mt-3 space-y-2 max-h-[480px] overflow-y-auto pr-1">
            {tracks.map((t, i) => {
              const active = i === currentIndex;
              return (
                <button
                  key={t.id}
                  onClick={() => onSelect(i)}
                  className={[
                    "w-full flex items-center justify-between rounded-xl px-3 py-3 text-left border transition-all",
                    active
                      ? "bg-cyan-700/50 border-cyan-400/70 shadow-[0_0_18px_rgba(34,211,238,0.3)]"
                      : "bg-slate-950/40 border-slate-700/70 hover:border-slate-500/70"
                  ].join(" ")}
                >
                  <div className="flex items-center gap-3 min-w-0">
                    <div className="w-5 text-xs text-slate-500">
                      {String(i + 1).padStart(2, "0")}
                    </div>
                    <div className="flex flex-col min-w-0">
                      <span className="text-sm text-slate-100 truncate">
                        {t.name}
                      </span>
                      <span className="text-[11px] text-cyan-300/80">
                        Track {i + 1}
                      </span>
                    </div>
                  </div>
                </button>
              );
            })}
          </div>
        </div>
      );
    }

    // ----------------- Root app -------------------

    function MusicApp() {
      const [currentIndex, setCurrentIndex] = useState(0);
      const [theme, setTheme] = useState("nite life");
      const [isPlaying, setIsPlaying] = useState(false);
      const [currentTime, setCurrentTime] = useState(0);
      const [duration, setDuration] = useState(0);

      const audioRef = useRef(null);
      const [audioEl, setAudioEl] = useState(null);

      const level = useAudioLevel(audioEl, isPlaying);

      // Create audio element once
      useEffect(() => {
        if (audioRef.current) return;

        const audio = new Audio();
        audioRef.current = audio;
        setAudioEl(audio);

        audio.addEventListener("timeupdate", () => {
          setCurrentTime(audio.currentTime || 0);
        });

        audio.addEventListener("loadedmetadata", () => {
          setDuration(audio.duration || 0);
        });

        audio.addEventListener("ended", () => {
          setCurrentIndex((prev) => (prev + 1) % TRACKS.length);
          setIsPlaying(true); // keep rolling to next track
        });
      }, []);

      // Load track when index or isPlaying changes
      useEffect(() => {
        const audio = audioRef.current;
        if (!audio) return;

        const t = TRACKS[currentIndex];
        if (!t) return;

        audio.src = AUDIO_BASE + t.file;
        audio.load();
        setCurrentTime(0);

        if (isPlaying) {
          audio.play().catch(() => setIsPlaying(false));
        }
      }, [currentIndex, isPlaying]);

      const handlePlay = () => {
        const audio = audioRef.current;
        if (!audio) return;
        audio.play()
          .then(() => setIsPlaying(true))
          .catch(() => {});
      };

      const handlePause = () => {
        const audio = audioRef.current;
        if (!audio) return;
        audio.pause();
        setIsPlaying(false);
      };

      const handleStop = () => {
        const audio = audioRef.current;
        if (!audio) return;
        audio.pause();
        audio.currentTime = 0;
        setCurrentTime(0);
        setIsPlaying(false);
      };

      const handlePrev = () => {
        setCurrentIndex((prev) => (prev - 1 + TRACKS.length) % TRACKS.length);
      };

      const handleNext = () => {
        setCurrentIndex((prev) => (prev + 1) % TRACKS.length);
      };

      const handleSelectTrack = (index) => {
        setCurrentIndex(index);
        const audio = audioRef.current;
        if (audio) {
          audio.play()
            .then(() => setIsPlaying(true))
            .catch(() => {});
        } else {
          setIsPlaying(true);
        }
      };

      const handleSeek = (newTime) => {
        const audio = audioRef.current;
        if (!audio || !isFinite(newTime)) return;
        audio.currentTime = newTime;
        setCurrentTime(newTime);
      };

      const activeTrack = TRACKS[currentIndex];

      return (
        <div className="mt-6 flex flex-col items-center">
          <ThemeChips activeTheme={theme} onChange={setTheme} />

          <TubeDeck
            trackName={activeTrack ? activeTrack.name : ""}
            currentTime={currentTime}
            duration={duration}
            theme={theme}
            level={level}
            onSeek={handleSeek}
          />

          <VintageControls
            onPlay={handlePlay}
            onPause={handlePause}
            onStop={handleStop}
            onPrev={handlePrev}
            onNext={handleNext}
            isPlaying={isPlaying}
            theme={theme}
          />

          <Playlist
            tracks={TRACKS}
            currentIndex={currentIndex}
            onSelect={handleSelectTrack}
            theme={theme}
          />
        </div>
      );
    }

    // Mount the app
    const rootEl = document.getElementById("root");
    if (rootEl) {
      const root = ReactDOM.createRoot(rootEl);
      root.render(<MusicApp />);
    }
  </script>
</body>
</html>
